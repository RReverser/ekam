#! /bin/sh

# This is a one-off rule that builds intercept.so from intercept.c.

set -eu

INPUT=intercept.c
echo findProvider file:intercept.c
read INPUT_DISK_PATH

OUTPUT="${INPUT%.c}.so"
echo newOutput "$OUTPUT"
read OUTPUT_DISK_PATH

if test `uname` = Linux; then
  gcc -g -shared -Wall -Wl,-no-undefined -fPIC -o "$OUTPUT_DISK_PATH" "$INPUT_DISK_PATH" -ldl
else
  gcc -g -shared -Wall -fPIC -o "$OUTPUT_DISK_PATH" "$INPUT_DISK_PATH"
fi

echo provide $OUTPUT_DISK_PATH special:ekam-interceptor
